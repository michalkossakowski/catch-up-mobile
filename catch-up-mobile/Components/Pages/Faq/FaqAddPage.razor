@page "/faq/add"

@inject HttpClient _httpClient
@inject NavigationManager NavigationManager

@using catch_up_mobile.Dtos
@using System.ComponentModel.DataAnnotations
@using System.ComponentModel.DataAnnotations.Schema

<div class="container text-start">

    <h2 class="text-center">Add New FAQ</h2>

    <EditForm Model="faqModel" OnValidSubmit="AddFaq">
        <DataAnnotationsValidator />

        <div>
            <label for="Title">Title:</label>
            <InputText id="Title" class="form-control" @bind-Value="faqModel.Title" placeholder="Enter title ..." />
            <ValidationMessage For="@(() => faqModel.Title)" />
        </div>
        <br />
        <div>
            <label for="Answer">Answer:</label>
            <InputTextArea rows="8" id="Answer" class="form-control" @bind-Value="faqModel.Answer" placeholder="Enter answer ..." />
            <ValidationMessage For="@(() => faqModel.Answer)" />
        </div>
        <br />
        <button type="button" class="btn btn-primary text-center" data-bs-toggle="modal" data-bs-target="#saveConfirmationModal">
            Add FAQ
        </button>
    </EditForm>

</div>

<div class="modal fade text-center" id="saveConfirmationModal" tabindex="-1" aria-labelledby="saveModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="saveModalLabel">Confirm Adding</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h5>Are you sure you want to add new FAQ?</h5>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" @onclick="ConfirmAddFaq">Add</button>
            </div>
        </div>
    </div>
</div>

@code {
    private FaqModel faqModel = new FaqModel();
    private class FaqModel
    {
        [Required(ErrorMessage = "Title is required")]
        [StringLength(int.MaxValue, MinimumLength = 3, ErrorMessage = "Title must be at least 3 characters long")]
        public string Title { get; set; }

        [Required(ErrorMessage = "Answer is required")]
        [StringLength(int.MaxValue, MinimumLength = 3, ErrorMessage = "Answer must be at least 3 characters long")]
        public string Answer { get; set; }
        
        // Waiting for materials
    }

    private async Task ConfirmAddFaq()
    {
        await AddFaq();
    }

    private async Task AddFaq()
    {
        await _httpClient.PostAsJsonAsync("api/faq/add", faqModel);
        NavigationManager.NavigateTo("/faqmanage");
    }
}
